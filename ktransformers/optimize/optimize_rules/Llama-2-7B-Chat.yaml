- match:
    class: ktransformers.models.modeling_llama.LlamaRotaryEmbedding
  replace:
    class: ktransformers.operators.RoPE.RotaryEmbeddingV2
    kwargs:
      generate_device: "cuda"
      prefill_device: "cuda"

- match:
    name: "^model.embed_tokens"
  replace:
    class: "default"
    kwargs:
      generate_device: "cpu"

- match:
    class: ktransformers.models.modeling_llama.LlamaModel
  replace:
    class: ktransformers.operators.models.KLlamaModel
    kwargs:
      generate_device: "cuda"
      prefill_device: "cuda"

- match:
    name: "^model\\.layers\\..*\\.self_attn$"
  replace:
    class: ktransformers.operators.attention.KLlamaAttention 
    kwargs:
      generate_device: "cuda"
      prefill_device: "cuda"

- match:
    name: "^model\\.layers\\..*\\.mlp$"
  replace:
    class: "default"
    kwargs:
      generate_device: "cpu"

- match:
    name: "^model\\.layers\\..*"
  replace:
    class: "default"
    kwargs:
      generate_device: "cuda"
      prefill_device: "cuda"

